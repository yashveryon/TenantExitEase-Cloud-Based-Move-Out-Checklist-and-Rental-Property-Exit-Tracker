<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="theme-color" content="#2563eb" />
  <title>TenantExitEase Login</title>

  <!-- Tailwind CSS & SweetAlert2 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="min-h-screen bg-cover bg-center bg-no-repeat relative flex items-center justify-center px-4"
      style="background-image: url('assets/login.jpeg');">

  <!-- Dark overlay for contrast -->
  <div class="absolute inset-0 bg-black bg-opacity-60 z-0"></div>

  <!-- Optional Loader -->
  <div id="loader" class="hidden fixed inset-0 z-50 bg-white bg-opacity-60 flex items-center justify-center">
    <div class="w-10 h-10 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
  </div>

  <!-- Login Box -->
  <div class="relative z-10 backdrop-blur-lg bg-white/10 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md space-y-6">
    <h2 class="text-2xl font-bold text-center text-white drop-shadow">Login to TenantExitEase</h2>

    <form id="loginForm" class="space-y-4" aria-label="Login Form">
      <div>
        <label for="username" class="block text-sm font-medium text-white">Username</label>
        <input
          type="text"
          id="username"
          autocomplete="username"
          placeholder="Enter your username"
          required
          class="w-full p-3 border border-gray-300 rounded bg-white/90 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
      </div>
      <div>
        <label for="password" class="block text-sm font-medium text-white">Password</label>
        <input
          type="password"
          id="password"
          autocomplete="current-password"
          placeholder="Enter your password"
          required
          class="w-full p-3 border border-gray-300 rounded bg-white/90 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
      </div>
      <button
        id="loginBtn"
        type="submit"
        class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded font-semibold transition-all duration-200 hover:scale-[1.02] shadow-md"
      >
        Login
      </button>
    </form>
  </div>

  <!-- Login Script -->
  <script>
    document.getElementById("loginForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();
      const btn = document.getElementById("loginBtn");
      const loader = document.getElementById("loader");

      btn.disabled = true;
      btn.textContent = "Logging in...";
      loader.classList.remove("hidden");

      try {
        const response = await fetch("http://127.0.0.1:8000/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          credentials: "include",
          body: JSON.stringify({ username, password }),
        });

        const data = await response.json();

        if (!response.ok || !data.role) throw new Error("Invalid credentials");

        // Redirect user based on role
        if (data.role === "admin") {
          window.location.href = "admin.html";
        } else if (data.role === "tenant") {
          window.location.href = "index.html";
        } else if (data.role === "landlord") {
          window.location.href = "landlord.html";
        } else {
          throw new Error("Unknown user role");
        }

      } catch (err) {
        Swal.fire({
          icon: 'error',
          title: 'Login Failed',
          text: err.message.includes("Failed to fetch")
            ? "Unable to reach server. Check backend connection."
            : "Please check your username or password.",
          confirmButtonColor: '#1e40af',
        });
      } finally {
        btn.disabled = false;
        btn.textContent = "Login";
        loader.classList.add("hidden");
      }
    });
  </script>
</body>
</html>
